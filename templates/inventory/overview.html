{% extends 'base.html' %}
{% load humanize %}
{% load inventory_extras %}
{% comment %} templates/inventory/overview.html - 재고 관리 개요 대시보드 {% endcomment %}

{% block title %}재고 개요 - Shopuda ERP{% endblock %}

{% block breadcrumb %}
<div class="flex items-center space-x-2">
    <i class="fas fa-home w-4 h-4"></i>
    <span class="text-gray-400 dark:text-gray-500">/</span>
    <i class="fas fa-boxes w-4 h-4"></i>
    <span>재고 관리</span>
    <span class="text-gray-400 dark:text-gray-500">/</span>
    <span>개요</span>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .metric-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .dark .metric-card:hover {
        box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar {
        background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        transition: width 0.5s ease-in-out;
    }
    
    .alert-progress {
        background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
    }
    
    .critical-progress {
        background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
    }
    
    .chart-container {
        position: relative;
        height: 300px;
    }
    
    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.4); }
        50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.6); }
    }
    
    .status-indicator {
        animation: pulse-glow 2s infinite;
    }
    
    /* 사이드바와 겹침 방지를 위한 추가 마진 */
    @media (min-width: 1024px) {
        .main-content {
            margin-left: 0;
            padding-left: 0;
        }
        
        /* 테이블이 사이드바와 겹치지 않도록 보장 */
        .table-container {
            width: 100%;
            max-width: calc(100vw - 20rem); /* 사이드바 너비 + 여백 */
        }
        
        /* 전체 콘텐츠 영역 제한 */
        .content-wrapper {
            max-width: calc(100vw - 20rem);
            margin-left: 0;
            padding-left: 0;
        }
        
        /* 오버플로우 방지 */
        .overflow-container {
            max-width: 100%;
            overflow-x: auto;
            padding-right: 1rem; /* 스크롤바 공간 확보 */
        }
        
        /* 테이블 스크롤 개선 */
        .table-scroll {
            max-height: 600px;
            overflow-y: auto;
        }
    }
    
    @media (max-width: 1023px) {
        .table-container {
            max-width: calc(100vw - 2rem);
        }
        
        .content-wrapper {
            max-width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-8 w-full content-wrapper" x-data="inventoryOverview()">
    <!-- 상단 액션 바 -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
            <div>
                <h1 class="text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white">
                    재고 관리 개요
                </h1>
                <p class="text-gray-500 dark:text-gray-400 mt-1">
                    전체 재고 현황과 주요 지표를 한눈에 확인하세요
                </p>
            </div>
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                <button @click="refreshData()" 
                        class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200">
                    <i class="fas fa-sync-alt mr-2" :class="{ 'animate-spin': isLoading }"></i>
                    새로고침
                </button>
                <a href="{% url 'inventory:adjustment' %}" 
                   class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200">
                    <i class="fas fa-edit mr-2"></i>
                    재고 조정
                </a>
                <button @click="exportReport()" 
                        class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200">
                    <i class="fas fa-file-export mr-2"></i>
                    보고서 내보내기
                </button>
            </div>
        </div>
    </div>

    <!-- 주요 지표 카드 -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- 총 상품 수 -->
        <div class="metric-card bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">총 상품 수</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ metrics.total_products|floatformat:0 }}</p>
                    <p class="text-sm text-green-600 dark:text-green-400 mt-1">
                        <i class="fas fa-arrow-up"></i>
                        <span>{{ metrics.products_growth }}</span> 지난 달 대비
                    </p>
                </div>
                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                    <i class="fas fa-boxes text-blue-600 dark:text-blue-400 text-xl"></i>
                </div>
            </div>
        </div>

        <!-- 총 재고 가치 -->
        <div class="metric-card bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">총 재고 가치</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ metrics.total_value|floatformat:0|add_comma }}원</p>
                    <p class="text-sm text-green-600 dark:text-green-400 mt-1">
                        <i class="fas fa-arrow-up"></i>
                        <span>{{ metrics.value_growth }}</span> 지난 달 대비
                    </p>
                </div>
                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                    <i class="fas fa-won-sign text-green-600 dark:text-green-400 text-xl"></i>
                </div>
            </div>
        </div>

        <!-- 부족 재고 -->
        <div class="metric-card bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">부족 재고</p>
                    <p class="text-3xl font-bold text-red-600 dark:text-red-400">{{ metrics.low_stock_items }}</p>
                    <p class="text-sm text-red-600 dark:text-red-400 mt-1">
                        <i class="fas fa-exclamation-triangle"></i>
                        즉시 보충 필요
                    </p>
                </div>
                <div class="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400 text-xl"></i>
                </div>
            </div>
        </div>

        <!-- 품절 상품 -->
        <div class="metric-card bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">품절 상품</p>
                    <p class="text-3xl font-bold text-orange-600 dark:text-orange-400">{{ metrics.out_of_stock_items }}</p>
                    <p class="text-sm text-orange-600 dark:text-orange-400 mt-1">
                        <i class="fas fa-times-circle"></i>
                        재고 없음
                    </p>
                </div>
                <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
                    <i class="fas fa-times-circle text-orange-600 dark:text-orange-400 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- 재고 상태 분포 및 차트 섹션 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- 재고 상태 분포 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">재고 상태 분포</h3>
                <div class="status-indicator w-3 h-3 bg-blue-500 rounded-full"></div>
            </div>
            
            <div class="space-y-4">
                <!-- 정상 재고 -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">정상 재고</span>
                    </div>
                    <span class="text-sm font-bold text-gray-900 dark:text-white">{{ stock_distribution.normal }}</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div class="progress-bar h-2 rounded-full" 
                         style="width: {{ stock_distribution.normal_percent }}%"></div>
                </div>

                <!-- 주의 재고 -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">주의 재고</span>
                    </div>
                    <span class="text-sm font-bold text-gray-900 dark:text-white">{{ stock_distribution.warning }}</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div class="alert-progress h-2 rounded-full" 
                         style="width: {{ stock_distribution.warning_percent }}%"></div>
                </div>

                <!-- 위험 재고 -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">위험 재고</span>
                    </div>
                    <span class="text-sm font-bold text-gray-900 dark:text-white">{{ stock_distribution.critical }}</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div class="critical-progress h-2 rounded-full" 
                         style="width: {{ stock_distribution.critical_percent }}%"></div>
                </div>
            </div>
        </div>

        <!-- 재고 추이 차트 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">재고 가치 추이</h3>
                <select x-model="chartPeriod" @change="updateChart()" 
                        class="text-sm border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="7days">최근 7일</option>
                    <option value="30days">최근 30일</option>
                    <option value="90days">최근 90일</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="stockTrendChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 부족 재고 알림 및 카테고리별 현황 -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- 부족 재고 알림 -->
        <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                    <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                    부족 재고 알림
                </h3>
                <a href="{% url 'products:list' %}?stock_status=low" 
                   class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium">
                    전체 보기 →
                </a>
            </div>
            <div class="space-y-3">
                {% for item in low_stock_items %}
                <div class="flex items-center justify-between p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-box text-red-600 dark:text-red-400"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">{{ item.name }}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                현재: {{ item.stock_quantity }} / 
                                최소: {{ item.min_stock_level }}
                            </p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium text-red-600 dark:text-red-400">부족</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ item.deficit }}개 부족</p>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                    <i class="fas fa-check-circle text-4xl text-green-500 mb-3"></i>
                    <p>현재 부족한 재고가 없습니다!</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- 카테고리별 재고 현황 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">카테고리별 현황</h3>
                <i class="fas fa-chart-pie text-gray-400"></i>
            </div>
            <div class="space-y-4">
                {% for category in category_stats %}
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                             style="background-color: {{ category.color }}20; color: {{ category.color }}">
                            <i class="{{ category.icon }}"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">{{ category.name }}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ category.count }}개 상품</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-bold text-gray-900 dark:text-white">{{ category.value|floatformat:0|add_comma }}원</p>
                        <p class="text-xs {% if category.trend > 0 %}text-green-500{% else %}text-red-500{% endif %}">
                            <i class="{% if category.trend > 0 %}fas fa-arrow-up{% else %}fas fa-arrow-down{% endif %}"></i>
                            <span>{{ category.trend|floatformat:1 }}%</span>
                        </p>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                    <i class="fas fa-check-circle text-4xl text-green-500 mb-3"></i>
                    <p>카테고리별 데이터가 없습니다.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- 최근 재고 이동 내역 -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                <i class="fas fa-history text-blue-500 mr-2"></i>
                최근 재고 이동 내역
            </h3>
            <a href="#" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium">
                전체 내역 보기 →
            </a>
        </div>
        <div class="overflow-container">
            <div class="table-container">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">상품명</th>
                            <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">변경 유형</th>
                            <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">수량 변화</th>
                            <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">변경 후</th>
                            <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">일시</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        {% for movement in recent_movements %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                            <td class="px-3 lg:px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-box text-gray-500 text-sm"></i>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">{{ movement.product_name }}</span>
                                </div>
                            </td>
                            <td class="px-3 lg:px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                    {% if movement.type == 'SALE' %}bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400
                                    {% elif movement.type == 'PURCHASE' or movement.type == 'IN' %}bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400
                                    {% elif movement.type == 'ADJUST' %}bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400
                                    {% elif movement.type == 'RETURN' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400
                                    {% else %}bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400{% endif %}">
                                    {{ movement.type_display }}
                                </span>
                            </td>
                            <td class="px-3 lg:px-6 py-4 whitespace-nowrap text-sm {% if movement.quantity_change > 0 %}text-green-600 dark:text-green-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                                {% if movement.quantity_change > 0 %}+{% endif %}{{ movement.quantity_change }}
                            </td>
                            <td class="px-3 lg:px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">{{ movement.current_stock }}</td>
                            <td class="px-3 lg:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ movement.created_at|format_date:"%Y-%m-%d %H:%M" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="px-3 lg:px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                최근 재고 이동 내역이 없습니다.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
function inventoryOverview() {
    return {
        isLoading: false,
        chartPeriod: '30days',
        stockTrendChart: null,
        chartData: {{ chart_data|safe }},

        init() {
            this.initChart();
        },

        initChart() {
            const ctx = document.getElementById('stockTrendChart');
            if (ctx) {
                const data = this.chartData[this.chartPeriod];
                this.stockTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: '재고 가치 (원)',
                            data: data.data,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)'
                                },
                                ticks: {
                                    color: '#6b7280',
                                    callback: function(value) {
                                        return new Intl.NumberFormat('ko-KR').format(value) + '원';
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)'
                                },
                                ticks: {
                                    color: '#6b7280'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        elements: {
                            point: {
                                hoverBackgroundColor: '#3b82f6'
                            }
                        }
                    }
                });
            }
        },

        async refreshData() {
            this.isLoading = true;
            this.showSuccess('데이터가 새로고침되었습니다.');
            // 실제로는 페이지 새로고침 또는 AJAX 요청
            setTimeout(() => {
                location.reload();
            }, 1000);
        },

        updateChart() {
            if (this.stockTrendChart && this.chartData[this.chartPeriod]) {
                const data = this.chartData[this.chartPeriod];
                this.stockTrendChart.data.labels = data.labels;
                this.stockTrendChart.data.datasets[0].data = data.data;
                this.stockTrendChart.update();
            }
        },

        async exportReport() {
            try {
                this.showLoading('보고서를 생성하고 있습니다...');
                
                // 실제 구현시에는 Django 뷰로 요청
                const response = await fetch('{% url "inventory:export_stock_data" %}', {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrf-token]').getAttribute('content')
                    }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `재고보고서_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    this.hideLoading();
                    this.showSuccess('재고 보고서가 다운로드되었습니다.');
                } else {
                    throw new Error('보고서 생성에 실패했습니다.');
                }
                
            } catch (error) {
                this.hideLoading();
                this.showError('보고서 생성 중 오류가 발생했습니다.');
            }
        },

        showSuccess(message) {
            Swal.fire({
                icon: 'success',
                title: '성공',
                text: message,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                background: document.documentElement.classList.contains('dark') ? '#374151' : '#ffffff',
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000'
            });
        },

        showError(message) {
            Swal.fire({
                icon: 'error',
                title: '오류',
                text: message,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 5000,
                timerProgressBar: true,
                background: document.documentElement.classList.contains('dark') ? '#374151' : '#ffffff',
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000'
            });
        },

        showLoading(message = '처리 중입니다...') {
            Swal.fire({
                title: message,
                allowOutsideClick: false,
                allowEscapeKey: false,
                showConfirmButton: false,
                background: document.documentElement.classList.contains('dark') ? '#374151' : '#ffffff',
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
                didOpen: () => {
                    Swal.showLoading();
                }
            });
        },

        hideLoading() {
            Swal.close();
        }
    }
}

// 페이지 로드시 초기화
document.addEventListener('DOMContentLoaded', function() {
    // 다크모드 차트 색상 업데이트
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                updateChartTheme();
            }
        });
    });
    
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
    });
});

function updateChartTheme() {
    // 차트 테마 업데이트 로직
    const isDark = document.documentElement.classList.contains('dark');
    // 필요시 차트 색상 업데이트
}
</script>
{% endblock %}