{% extends 'base.html' %}

{% block title %}시스템 설정 - {{ settings.site_name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">시스템 설정</h1>
        <p class="text-gray-600 dark:text-gray-300">전체 시스템의 설정을 관리합니다.</p>
    </div>

    <form method="post" class="space-y-6">
        {% csrf_token %}
        
        <!-- 탭 메뉴 -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
            <div class="border-b dark:border-gray-700">
                <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                    <button type="button" onclick="switchTab('brand')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="brand">
                        <i class="fas fa-building mr-2"></i>브랜드
                    </button>
                    <button type="button" onclick="switchTab('signup')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="signup">
                        <i class="fas fa-user-plus mr-2"></i>회원가입
                    </button>
                    <button type="button" onclick="switchTab('membership')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="membership">
                        <i class="fas fa-medal mr-2"></i>회원 등급
                    </button>
                    <button type="button" onclick="switchTab('points')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="points">
                        <i class="fas fa-coins mr-2"></i>포인트
                    </button>
                    <button type="button" onclick="switchTab('order')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="order">
                        <i class="fas fa-shopping-cart mr-2"></i>주문
                    </button>
                    <button type="button" onclick="switchTab('inventory')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="inventory">
                        <i class="fas fa-boxes mr-2"></i>재고
                    </button>
                    <button type="button" onclick="switchTab('product')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="product">
                        <i class="fas fa-box mr-2"></i>상품
                    </button>
                    <button type="button" onclick="switchTab('notification')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="notification">
                        <i class="fas fa-bell mr-2"></i>알림
                    </button>
                    <button type="button" onclick="switchTab('system')" 
                            class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition"
                            data-tab="system">
                        <i class="fas fa-cog mr-2"></i>시스템
                    </button>
                </nav>
            </div>

            <div class="p-6">
                <!-- 브랜드 설정 -->
                <div id="tab-brand" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">브랜드 설정</h2>
                    
                    <div>
                        <label for="{{ form.site_name.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            사이트 이름 <span class="text-red-500">*</span>
                        </label>
                        {{ form.site_name }}
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">모든 페이지에 표시되는 사이트 이름입니다.</p>
                    </div>
                    
                    <div>
                        <label for="{{ form.site_tagline.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            사이트 태그라인
                        </label>
                        {{ form.site_tagline }}
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">사이트를 설명하는 짧은 문구입니다.</p>
                    </div>
                    
                    <div>
                        <label for="{{ form.site_logo_url.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            로고 URL
                        </label>
                        {{ form.site_logo_url }}
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">로고 이미지의 URL을 입력하세요.</p>
                    </div>
                    
                    <div>
                        <label for="{{ form.currency_symbol.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            통화 기호
                        </label>
                        {{ form.currency_symbol }}
                    </div>
                    
                    <div>
                        <label for="{{ form.currency_code.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            통화 코드
                        </label>
                        {{ form.currency_code }}
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">ISO 4217 통화 코드 (예: KRW, USD)</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="{{ form.business_hours_start.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                업무 시작 시간
                            </label>
                            {{ form.business_hours_start }}
                        </div>
                        <div>
                            <label for="{{ form.business_hours_end.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                업무 종료 시간
                            </label>
                            {{ form.business_hours_end }}
                        </div>
                    </div>
                </div>
                
                <!-- 회원가입 설정 -->
                <div id="tab-signup" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">회원가입 설정</h2>
                    
                    <div class="flex items-center">
                        {{ form.signup_enabled }}
                        <label for="{{ form.signup_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            회원가입 허용
                        </label>
                    </div>
                    
                    <div class="flex items-center">
                        {{ form.email_verification_required }}
                        <label for="{{ form.email_verification_required.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            이메일 인증 필수
                        </label>
                    </div>
                    
                    <div class="border-t dark:border-gray-700 pt-6">
                        <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">회원가입 포인트</h3>
                        
                        <div class="flex items-center mb-4">
                            {{ form.welcome_points_enabled }}
                            <label for="{{ form.welcome_points_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                                회원가입 포인트 지급
                            </label>
                        </div>
                        
                        <div>
                            <label for="{{ form.welcome_points_amount.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                지급 포인트
                            </label>
                            {{ form.welcome_points_amount }}
                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">신규 회원가입 시 지급할 포인트 금액</p>
                        </div>
                    </div>
                </div>
                
                <!-- 회원 등급 설정 -->
                <div id="tab-membership" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">회원 등급 설정</h2>
                    
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
                        총 구매금액에 따른 회원 등급 기준을 설정합니다.
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.membership_bronze_threshold.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">브론즈</span>
                                기준 금액
                            </label>
                            {{ form.membership_bronze_threshold }}
                        </div>
                        
                        <div>
                            <label for="{{ form.membership_silver_threshold.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200">실버</span>
                                기준 금액
                            </label>
                            {{ form.membership_silver_threshold }}
                        </div>
                        
                        <div>
                            <label for="{{ form.membership_gold_threshold.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">골드</span>
                                기준 금액
                            </label>
                            {{ form.membership_gold_threshold }}
                        </div>
                        
                        <div>
                            <label for="{{ form.membership_platinum_threshold.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">플래티넘</span>
                                기준 금액
                            </label>
                            {{ form.membership_platinum_threshold }}
                        </div>
                        
                        <div>
                            <label for="{{ form.membership_diamond_threshold.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">다이아몬드</span>
                                기준 금액
                            </label>
                            {{ form.membership_diamond_threshold }}
                        </div>
                    </div>
                </div>
                
                <!-- 포인트 설정 -->
                <div id="tab-points" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">포인트 설정</h2>
                    
                    <div class="flex items-center">
                        {{ form.points_enabled }}
                        <label for="{{ form.points_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            포인트 시스템 사용
                        </label>
                    </div>
                    
                    <div>
                        <label for="{{ form.points_rate.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            포인트 적립률 (%)
                        </label>
                        {{ form.points_rate }}
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">구매 금액의 몇 %를 포인트로 적립할지 설정합니다.</p>
                    </div>
                    
                    <div>
                        <label for="{{ form.points_expiry_days.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            포인트 유효기간 (일)
                        </label>
                        {{ form.points_expiry_days }}
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">0으로 설정하면 무기한 유효합니다.</p>
                    </div>
                    
                    <div>
                        <label for="{{ form.min_points_to_use.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            포인트 최소 사용 금액
                        </label>
                        {{ form.min_points_to_use }}
                    </div>
                </div>
                
                <!-- 주문 설정 -->
                <div id="tab-order" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">주문 설정</h2>
                    
                    <div>
                        <label for="{{ form.order_prefix.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            주문번호 접두사
                        </label>
                        {{ form.order_prefix }}
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">주문번호 앞에 붙는 문자</p>
                    </div>
                    
                    <div>
                        <label for="{{ form.order_cancel_days.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            주문 취소 가능 기간 (일)
                        </label>
                        {{ form.order_cancel_days }}
                    </div>
                    
                    <div>
                        <label for="{{ form.auto_confirm_days.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            자동 구매확정 기간 (일)
                        </label>
                        {{ form.auto_confirm_days }}
                    </div>
                </div>
                
                <!-- 재고 설정 -->
                <div id="tab-inventory" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">재고 설정</h2>
                    
                    <div>
                        <label for="{{ form.low_stock_threshold.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            재고 부족 기준 수량
                        </label>
                        {{ form.low_stock_threshold }}
                    </div>
                    
                    <div class="flex items-center">
                        {{ form.stock_alert_enabled }}
                        <label for="{{ form.stock_alert_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            재고 부족 알림 사용
                        </label>
                    </div>
                    
                    <div class="flex items-center">
                        {{ form.negative_stock_allowed }}
                        <label for="{{ form.negative_stock_allowed.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            마이너스 재고 허용
                        </label>
                    </div>
                </div>
                
                <!-- 상품 설정 -->
                <div id="tab-product" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">상품 설정</h2>
                    
                    <div class="flex items-center">
                        {{ form.product_review_enabled }}
                        <label for="{{ form.product_review_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            상품 리뷰 기능 사용
                        </label>
                    </div>
                    
                    <div class="border-t dark:border-gray-700 pt-6">
                        <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">리뷰 포인트</h3>
                        
                        <div class="flex items-center mb-4">
                            {{ form.review_points_enabled }}
                            <label for="{{ form.review_points_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                                리뷰 작성 포인트 지급
                            </label>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="{{ form.review_points_amount.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    일반 리뷰 포인트
                                </label>
                                {{ form.review_points_amount }}
                            </div>
                            
                            <div>
                                <label for="{{ form.photo_review_bonus_points.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    포토리뷰 추가 포인트
                                </label>
                                {{ form.photo_review_bonus_points }}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 알림 설정 -->
                <div id="tab-notification" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">알림 설정</h2>
                    
                    <div class="flex items-center">
                        {{ form.email_notifications_enabled }}
                        <label for="{{ form.email_notifications_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            이메일 알림 사용
                        </label>
                    </div>
                    
                    <div class="flex items-center">
                        {{ form.sms_notifications_enabled }}
                        <label for="{{ form.sms_notifications_enabled.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            SMS 알림 사용
                        </label>
                    </div>
                    
                    <div class="flex items-center">
                        {{ form.order_notification_admin }}
                        <label for="{{ form.order_notification_admin.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            주문 시 관리자 알림
                        </label>
                    </div>
                    
                    <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <p class="text-sm text-blue-800 dark:text-blue-200">
                            <i class="fas fa-info-circle mr-2"></i>
                            이메일 템플릿은 <a href="{% url 'core:email_template_list' %}" class="underline font-medium">이메일 템플릿 관리</a>에서 설정할 수 있습니다.
                        </p>
                    </div>
                </div>
                
                <!-- 시스템 설정 -->
                <div id="tab-system" class="tab-content space-y-6" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">시스템 설정</h2>
                    
                    <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg mb-6">
                        <p class="text-sm text-red-800 dark:text-red-200">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            <strong>주의:</strong> 유지보수 모드를 활성화하면 관리자를 제외한 모든 사용자가 사이트에 접속할 수 없습니다.
                        </p>
                    </div>
                    
                    <div class="flex items-center">
                        {{ form.maintenance_mode }}
                        <label for="{{ form.maintenance_mode.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            유지보수 모드 활성화
                        </label>
                    </div>
                    
                    <div>
                        <label for="{{ form.maintenance_message.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            유지보수 메시지
                        </label>
                        {{ form.maintenance_message }}
                    </div>
                </div>
            </div>
        </div>

        <!-- 저장 버튼 -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-500 dark:text-gray-400">
                    {% if settings.updated_at %}
                    마지막 수정: {{ settings.updated_at|date:"Y-m-d H:i" }}
                    {% if settings.updated_by %}
                    ({{ settings.updated_by.get_full_name|default:settings.updated_by.username }})
                    {% endif %}
                    {% endif %}
                </div>
                
                <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
                    <i class="fas fa-save mr-2"></i>설정 저장
                </button>
            </div>
        </div>
    </form>
</div>

<style>
.tab-button {
    color: #6b7280;
    border-color: transparent;
}

.tab-button:hover {
    color: #374151;
    border-color: #e5e7eb;
}

.dark .tab-button {
    color: #9ca3af;
}

.dark .tab-button:hover {
    color: #d1d5db;
    border-color: #4b5563;
}

.tab-button.active {
    color: #2563eb;
    border-color: #3b82f6;
}

.dark .tab-button.active {
    color: #60a5fa;
    border-color: #3b82f6;
}
</style>

<script>
// 탭 전환 함수
function switchTab(tabName) {
    // 모든 탭 컨텐츠 숨기기
    document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = 'none';
    });
    
    // 모든 탭 버튼 비활성화
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active', 'border-blue-500', 'text-blue-600', 'dark:text-blue-400');
        button.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
    });
    
    // 선택한 탭 표시
    document.getElementById('tab-' + tabName).style.display = 'block';
    
    // 선택한 탭 버튼 활성화
    const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
    activeButton.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
    activeButton.classList.add('active', 'border-blue-500', 'text-blue-600', 'dark:text-blue-400');
    
    // URL 업데이트 (페이지 새로고침 없이)
    const url = new URL(window.location);
    url.searchParams.set('tab', tabName);
    window.history.pushState({}, '', url);
}

// 페이지 로드 시 초기 탭 설정
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('tab') || 'brand';
    switchTab(activeTab);
});
</script>

{% if messages %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% for message in messages %}
        {% if message.tags == 'success' %}
            Swal.fire({
                icon: 'success',
                title: '성공',
                text: '{{ message }}',
                timer: 3000,
                showConfirmButton: false
            });
        {% elif message.tags == 'error' %}
            Swal.fire({
                icon: 'error',
                title: '오류',
                text: '{{ message }}',
            });
        {% endif %}
    {% endfor %}
});
</script>
{% endif %}
{% endblock %}