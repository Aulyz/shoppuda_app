{% extends 'base.html' %}

{% block title %}내 프로필 - Shopuda{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-7xl">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 dark:text-white">내 프로필</h1>
        <p class="text-gray-600 dark:text-gray-300 mt-2">계정 정보 및 활동 내역</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- 프로필 정보 -->
        <div class="lg:col-span-1">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <div class="text-center mb-6">
                    {% if user.profile_image %}
                    <img src="{{ user.profile_image.url }}" alt="프로필 이미지" 
                         class="w-32 h-32 rounded-full mx-auto mb-4 object-cover">
                    {% else %}
                    <div class="w-32 h-32 rounded-full bg-gray-300 dark:bg-gray-600 mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-user text-4xl text-gray-500 dark:text-gray-400"></i>
                    </div>
                    {% endif %}
                    
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white">
                        {{ user.get_full_name|default:user.username }}
                    </h2>
                    
                    <!-- 사용자 타입 및 레벨 표시 -->
                    <div class="mt-2">
                        {% if user.user_type == 'ADMIN' %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                                <i class="fas fa-user-shield mr-1"></i>
                                {{ user.get_user_type_display }}
                            </span>
                            {% if user.admin_level >= 5 %}
                            <div class="mt-2">
                                <span class="text-red-600 dark:text-red-400 font-bold">
                                    <i class="fas fa-crown mr-1"></i>레벨 {{ user.admin_level }}
                                </span>
                            </div>
                            {% elif user.admin_level > 0 %}
                            <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                레벨 {{ user.admin_level }} - {{ user.get_admin_level_display }}
                            </div>
                            {% endif %}
                        {% elif user.user_type == 'STAFF' %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                <i class="fas fa-id-badge mr-1"></i>
                                {{ user.get_user_type_display }}
                            </span>
                        {% else %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200">
                                {{ user.get_user_type_display }}
                            </span>
                        {% endif %}
                    </div>
                </div>

                <div class="border-t dark:border-gray-700 pt-4">
                    <div class="space-y-3">
                        <div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">이메일</span>
                            <p class="font-medium text-gray-800 dark:text-white">{{ user.email }}</p>
                        </div>
                        
                        {% if user.phone_number %}
                        <div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">전화번호</span>
                            <p class="font-medium text-gray-800 dark:text-white">{{ user.phone_number }}</p>
                        </div>
                        {% endif %}
                        
                        <div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">가입일</span>
                            <p class="font-medium text-gray-800 dark:text-white">{{ user.created_at|date:"Y년 m월 d일" }}</p>
                        </div>
                    </div>
                </div>

                <div class="mt-6 space-y-2">
                    <a href="{% url 'accounts:profile_edit' %}" 
                       class="block w-full bg-blue-600 hover:bg-blue-700 text-white text-center py-2 rounded-lg transition">
                        <i class="fas fa-edit mr-2"></i>프로필 수정
                    </a>
                    <a href="{% url 'accounts:password_change' %}" 
                       class="block w-full bg-gray-600 hover:bg-gray-700 text-white text-center py-2 rounded-lg transition">
                        <i class="fas fa-key mr-2"></i>비밀번호 변경
                    </a>
                </div>
            </div>

            <!-- 회원 정보 -->
            {% if user.user_type == 'CUSTOMER' %}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mt-6">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">회원 정보</h3>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-400">회원 등급</span>
                        <span class="font-medium text-gray-800 dark:text-white">
                            <i class="fas fa-medal text-{{ user.membership_level|lower }} mr-1"></i>
                            {{ user.get_membership_level_display }}
                        </span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-400">보유 포인트</span>
                        <span class="font-medium text-gray-800 dark:text-white">{{ user.points|default:0|floatformat:0 }}P</span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-400">총 구매액</span>
                        <span class="font-medium text-gray-800 dark:text-white">₩{{ user.total_purchase_amount|default:0|floatformat:0 }}</span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-400">구매 횟수</span>
                        <span class="font-medium text-gray-800 dark:text-white">{{ user.purchase_count|default:0 }}회</span>
                    </div>
                </div>
                
                <a href="{% url 'accounts:point_history' %}" 
                   class="block w-full mt-4 text-center text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm">
                    포인트 내역 보기 <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
            {% endif %}
        </div>

        <!-- 활동 내역 -->
        <div class="lg:col-span-2 space-y-6">
            <!-- 최근 주문 -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">최근 주문</h3>
                    <a href="#" class="text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm">
                        전체 보기 <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
                
                {% if recent_orders %}
                <div class="space-y-3">
                    {% for order in recent_orders %}
                    <div class="border dark:border-gray-700 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">주문번호: {{ order.order_number }}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ order.created_at|date:"Y-m-d H:i" }}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-gray-800 dark:text-white">₩{{ order.total_amount|floatformat:0 }}</p>
                                <span class="inline-flex px-2 py-1 text-xs rounded-full 
                                    {% if order.status == 'DELIVERED' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
                                    {% elif order.status == 'CANCELLED' %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200
                                    {% else %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200{% endif %}">
                                    {{ order.get_status_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 dark:text-gray-400 text-center py-8">주문 내역이 없습니다.</p>
                {% endif %}
            </div>

            <!-- 최근 포인트 내역 -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">최근 포인트 내역</h3>
                    <a href="{% url 'accounts:point_history' %}" class="text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm">
                        전체 보기 <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
                
                {% if recent_points %}
                <div class="space-y-2">
                    {% for point in recent_points %}
                    <div class="flex justify-between items-center py-2 border-b dark:border-gray-700 last:border-0">
                        <div>
                            <p class="text-sm font-medium text-gray-800 dark:text-white">{{ point.description }}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ point.created_at|date:"Y-m-d H:i" }}</p>
                        </div>
                        <div class="text-right">
                            {% if point.point_type == 'EARN' or point.point_type == 'CANCEL' %}
                            <p class="font-medium text-green-600 dark:text-green-400">+{{ point.amount }}P</p>
                            {% else %}
                            <p class="font-medium text-red-600 dark:text-red-400">-{{ point.amount }}P</p>
                            {% endif %}
                            <p class="text-xs text-gray-500 dark:text-gray-400">잔액: {{ point.balance }}P</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 dark:text-gray-400 text-center py-8">포인트 내역이 없습니다.</p>
                {% endif %}
            </div>

            <!-- 배송지 관리 -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">배송지 관리</h3>
                    <a href="{% url 'accounts:shipping_addresses' %}" class="text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm">
                        관리하기 <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
                
                {% if shipping_addresses %}
                <div class="space-y-3">
                    {% for address in shipping_addresses|slice:":3" %}
                    <div class="border dark:border-gray-700 rounded-lg p-3">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">
                                    {{ address.nickname }}
                                    {% if address.is_default %}
                                    <span class="ml-2 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 px-2 py-1 rounded">기본</span>
                                    {% endif %}
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                    {{ address.recipient_name }} | {{ address.phone_number }}
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    {{ address.address }} {{ address.detail_address }}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 dark:text-gray-400 text-center py-8">등록된 배송지가 없습니다.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}