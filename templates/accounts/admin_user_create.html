{% extends 'base.html' %}

{% block title %}새 사용자 추가 - Shopuda{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="mb-8">
        <a href="{% url 'accounts:admin_user_list' %}" class="text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block">
            <i class="fas fa-arrow-left mr-2"></i>사용자 목록으로
        </a>
        
        <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">새 사용자 추가</h1>
        <p class="text-gray-600 dark:text-gray-300">관리자 권한으로 새 사용자를 생성합니다.</p>
    </div>

    <form method="post" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        {% csrf_token %}
        
        <!-- 오류 메시지 표시 -->
        {% if form.non_field_errors %}
        <div class="mb-6 p-4 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded-lg">
            {% for error in form.non_field_errors %}
            <p class="text-red-700 dark:text-red-300 text-sm">{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 아이디 -->
            <div>
                <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.username.label }} <span class="text-red-500">*</span>
                </label>
                {{ form.username }}
                {% if form.username.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.username.errors|first }}</p>
                {% endif %}
                {% if form.username.help_text %}
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">{{ form.username.help_text }}</p>
                {% endif %}
            </div>

            <!-- 이메일 -->
            <div>
                <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.email.label }} <span class="text-red-500">*</span>
                </label>
                {{ form.email }}
                {% if form.email.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.email.errors|first }}</p>
                {% endif %}
            </div>

            <!-- 비밀번호 -->
            <div>
                <label for="{{ form.password1.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    비밀번호 <span class="text-red-500">*</span>
                </label>
                {{ form.password1 }}
                {% if form.password1.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.password1.errors|first }}</p>
                {% endif %}
            </div>

            <!-- 비밀번호 확인 -->
            <div>
                <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    비밀번호 확인 <span class="text-red-500">*</span>
                </label>
                {{ form.password2 }}
                {% if form.password2.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.password2.errors|first }}</p>
                {% endif %}
            </div>

            <!-- 이름 -->
            <div>
                <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.first_name.label }} <span class="text-red-500">*</span>
                </label>
                {{ form.first_name }}
                {% if form.first_name.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.first_name.errors|first }}</p>
                {% endif %}
            </div>

            <!-- 전화번호 -->
            <div>
                <label for="{{ form.phone_number.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.phone_number.label }} <span class="text-red-500">*</span>
                </label>
                {{ form.phone_number }}
                {% if form.phone_number.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.phone_number.errors|first }}</p>
                {% endif %}
            </div>

            <!-- 생년월일 -->
            <div>
                <label for="{{ form.birth_date.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.birth_date.label }}
                </label>
                {{ form.birth_date }}
                {% if form.birth_date.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.birth_date.errors|first }}</p>
                {% endif %}
            </div>

            <!-- 성별 -->
            <div>
                <label for="{{ form.gender.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.gender.label }}
                </label>
                {{ form.gender }}
                {% if form.gender.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.gender.errors|first }}</p>
                {% endif %}
            </div>
        </div>

        <!-- 주소 정보 -->
        <div class="mt-6 pt-6 border-t dark:border-gray-700">
            <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">주소 정보 (선택)</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- 우편번호 -->
                <div>
                    <label for="{{ form.postal_code.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        {{ form.postal_code.label }}
                    </label>
                    <div class="flex gap-2">
                        {{ form.postal_code }}
                        <button type="button" onclick="execDaumPostcode()" 
                                class="px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded-lg transition">
                            검색
                        </button>
                    </div>
                </div>

                <!-- 주소 -->
                <div class="md:col-span-2">
                    <label for="{{ form.address.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        {{ form.address.label }}
                    </label>
                    {{ form.address }}
                </div>

                <!-- 상세주소 -->
                <div class="md:col-span-3">
                    <label for="{{ form.detail_address.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        {{ form.detail_address.label }}
                    </label>
                    {{ form.detail_address }}
                </div>
            </div>
        </div>

        <!-- 약관 동의 -->
        <div class="mt-6 pt-6 border-t dark:border-gray-700">
            <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">약관 동의</h3>
            
            <div class="space-y-3">
                <div class="flex items-start">
                    {{ form.terms_agreed }}
                    <label for="{{ form.terms_agreed.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                        {{ form.terms_agreed.label }} <span class="text-red-500">*</span>
                    </label>
                </div>
                {% if form.terms_agreed.errors %}
                <p class="ml-6 text-sm text-red-600 dark:text-red-400">{{ form.terms_agreed.errors|first }}</p>
                {% endif %}

                <div class="flex items-start">
                    {{ form.privacy_agreed }}
                    <label for="{{ form.privacy_agreed.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                        {{ form.privacy_agreed.label }} <span class="text-red-500">*</span>
                    </label>
                </div>
                {% if form.privacy_agreed.errors %}
                <p class="ml-6 text-sm text-red-600 dark:text-red-400">{{ form.privacy_agreed.errors|first }}</p>
                {% endif %}

                <div class="flex items-start">
                    {{ form.marketing_agreed }}
                    <label for="{{ form.marketing_agreed.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                        {{ form.marketing_agreed.label }} (선택)
                    </label>
                </div>
            </div>
        </div>

        <!-- 관리자 메모 -->
        <div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
            <p class="text-sm text-yellow-800 dark:text-yellow-200">
                <i class="fas fa-info-circle mr-2"></i>
                생성된 사용자의 초기 타입은 '고객'으로 설정됩니다. 
                사용자 타입이나 권한을 변경하려면 생성 후 사용자 목록에서 설정해주세요.
            </p>
        </div>

        <!-- 버튼 -->
        <div class="mt-8 flex justify-end space-x-4">
            <a href="{% url 'accounts:admin_user_list' %}" 
               class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                취소
            </a>
            <button type="submit" 
                    class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
                <i class="fas fa-user-plus mr-2"></i>사용자 생성
            </button>
        </div>
    </form>
</div>

<!-- 다음 우편번호 서비스 -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
function execDaumPostcode() {
    new daum.Postcode({
        oncomplete: function(data) {
            document.getElementById('id_postal_code').value = data.zonecode;
            document.getElementById('id_address').value = data.roadAddress;
            document.getElementById('id_detail_address').focus();
        }
    }).open();
}
</script>
{% endblock %}