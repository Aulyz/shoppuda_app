{% extends 'base.html' %}
{% load static %}

{% comment %} templates/platforms/sync_dashboard.html - 플랫폼 동기화 대시보드 {% endcomment %}

{% block title %}플랫폼 동기화 대시보드 - Shopuda ERP{% endblock %}

{% block breadcrumb %}
<div class="flex items-center space-x-2">
    <i class="fas fa-home w-4 h-4"></i>
    <span class="text-gray-400 dark:text-gray-500">/</span>
    <a href="{% url 'platforms:list' %}" class="hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200">플랫폼 관리</a>
    <span class="text-gray-400 dark:text-gray-500">/</span>
    <span>동기화 대시보드</span>
</div>
{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<meta name="csrf-token" content="{{ csrf_token }}">
<style>
    /* Alpine.js x-cloak 숨김 */
    [x-cloak] { 
        display: none !important; 
    }
    
    /* 실시간 상태 표시 애니메이션 */
    .status-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    .status-syncing {
        animation: rotate 1s linear infinite;
    }
    
    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* 프로그레스 바 스타일 */
    .progress-bar {
        background: linear-gradient(90deg, #3b82f6, #10b981);
        border-radius: 9999px;
        transition: width 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background-image: linear-gradient(
            -45deg,
            rgba(255, 255, 255, 0.2) 25%,
            transparent 25%,
            transparent 50%,
            rgba(255, 255, 255, 0.2) 50%,
            rgba(255, 255, 255, 0.2) 75%,
            transparent 75%,
            transparent
        );
        background-size: 1rem 1rem;
        animation: progressShine 1s linear infinite;
    }
    
    @keyframes progressShine {
        0% { background-position: 0 0; }
        100% { background-position: 1rem 0; }
    }
    
    /* 플랫폼 카드 호버 효과 */
    .platform-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
    }
    
    .platform-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .dark .platform-card:hover {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.25), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
    }
    
    /* 동기화 로그 스타일 */
    .sync-log {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .sync-log::-webkit-scrollbar {
        width: 6px;
    }
    
    .sync-log::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }
    
    .sync-log::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    
    .dark .sync-log::-webkit-scrollbar-track {
        background: #374151;
    }
    
    .dark .sync-log::-webkit-scrollbar-thumb {
        background: #6b7280;
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-8" x-data="syncDashboard()" x-init="init()">
    <!-- 페이지 헤더 -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 px-6 py-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center">
                        <i class="fas fa-sync-alt text-white text-2xl" :class="{ 'status-syncing': globalSyncInProgress }"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl lg:text-4xl font-bold text-white">플랫폼 동기화 대시보드</h1>
                        <p class="text-indigo-100 text-lg mt-2">
                            <span x-text="platforms.filter(p => p.is_active).length"></span>개 플랫폼의 실시간 동기화 상태를 관리하세요
                        </p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-3">
                    <button @click="syncAllPlatforms()" 
                            :disabled="globalSyncInProgress"
                            class="inline-flex items-center justify-center px-6 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white font-semibold hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-sync-alt mr-2" :class="{ 'status-syncing': globalSyncInProgress }"></i>
                        <span x-text="globalSyncInProgress ? '동기화 중...' : '전체 동기화'"></span>
                    </button>
                    
                    <button @click="refreshDashboard()" 
                            class="inline-flex items-center justify-center px-6 py-3 bg-white text-indigo-600 rounded-xl font-semibold hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200">
                        <i class="fas fa-refresh mr-2"></i>
                        새로고침
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 전체 통계 요약 -->
        <div class="bg-gray-50 dark:bg-gray-900/50 px-6 py-4">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-900 dark:text-white" x-text="stats.connected_platforms"></div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">연결된 플랫폼</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="stats.synced_products"></div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">동기화된 상품</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="formatNumber(stats.total_orders)"></div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">총 주문</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold" :class="stats.sync_errors > 0 ? 'text-red-600 dark:text-red-400' : 'text-gray-900 dark:text-white'" x-text="stats.sync_errors"></div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">동기화 오류</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 플랫폼 상태 카드 그리드 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
        <template x-for="platform in platforms" :key="platform.id">
            <div class="platform-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                <!-- 플랫폼 헤더 -->
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center" 
                                 :class="getPlatformBgColor(platform.platform_type)">
                                <i :class="getPlatformIcon(platform.platform_type)" class="text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="platform.name"></h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400" x-text="platform.platform_type"></p>
                            </div>
                        </div>
                        
                        <!-- 상태 표시 -->
                        <div class="flex items-center space-x-2">
                            <span class="px-3 py-1 rounded-full text-xs font-medium"
                                  :class="getStatusClass(platform.last_sync_status)">
                                <i :class="getStatusIcon(platform.last_sync_status)" class="mr-1"></i>
                                <span x-text="getStatusText(platform.last_sync_status)"></span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- 플랫폼 정보 -->
                <div class="p-6 space-y-4">
                    <!-- 동기화 진행률 -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">동기화 진행률</span>
                            <span class="text-sm text-gray-500 dark:text-gray-400" 
                                  x-text="platform.sync_progress + '%'"></span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" 
                                 :style="'width: ' + platform.sync_progress + '%'"></div>
                        </div>
                    </div>
                    
                    <!-- 통계 정보 -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                            <div class="text-xl font-bold text-gray-900 dark:text-white" 
                                 x-text="formatNumber(platform.product_count)"></div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">상품 수</div>
                        </div>
                        <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                            <div class="text-xl font-bold text-gray-900 dark:text-white" 
                                 x-text="formatNumber(platform.order_count)"></div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">주문 수</div>
                        </div>
                    </div>
                    
                    <!-- 마지막 동기화 시간 -->
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-500 dark:text-gray-400">마지막 동기화:</span>
                        <span class="text-gray-700 dark:text-gray-300" 
                              x-text="formatDateTime(platform.last_sync_at)"></span>
                    </div>
                    
                    <!-- 액션 버튼 -->
                    <div class="flex space-x-2 pt-2">
                        <button @click="syncPlatform(platform.id)" 
                                :disabled="platform.sync_in_progress"
                                class="flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg transition-colors duration-200 disabled:cursor-not-allowed">
                            <i class="fas fa-sync-alt mr-1" :class="{ 'status-syncing': platform.sync_in_progress }"></i>
                            <span x-text="platform.sync_in_progress ? '동기화 중' : '동기화'"></span>
                        </button>
                        
                        <button @click="viewPlatformLogs(platform.id)" 
                                class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                            <i class="fas fa-history"></i>
                        </button>
                        
                        <button @click="editPlatform(platform.id)" 
                                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- 실시간 동기화 로그 -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="bg-gradient-to-r from-gray-800 to-gray-900 px-6 py-4">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <i class="fas fa-terminal mr-3"></i>
                    실시간 동기화 로그
                </h2>
                <div class="flex items-center space-x-3">
                    <label class="flex items-center text-sm text-gray-300">
                        <input type="checkbox" x-model="autoRefreshLogs" class="mr-2 rounded">
                        자동 새로고침
                    </label>
                    <button @click="clearLogs()" 
                            class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm rounded-lg transition-colors">
                        <i class="fas fa-trash mr-1"></i>
                        Clear
                    </button>
                </div>
            </div>
        </div>
        
        <div class="p-6">
            <div class="sync-log bg-gray-900 dark:bg-gray-950 rounded-lg p-4 text-sm font-mono">
                <template x-for="log in syncLogs" :key="log.id">
                    <div class="flex items-start space-x-3 py-1" 
                         :class="getLogLevelClass(log.level)">
                        <span class="text-gray-500 dark:text-gray-400 text-xs w-20" 
                              x-text="formatTime(log.timestamp)"></span>
                        <span class="w-16 text-xs uppercase font-semibold" 
                              :class="getLogLevelTextClass(log.level)" 
                              x-text="log.level"></span>
                        <span class="flex-1" x-text="log.message"></span>
                    </div>
                </template>
                
                <div x-show="syncLogs.length === 0" class="text-gray-500 dark:text-gray-400 text-center py-8">
                    <i class="fas fa-inbox text-3xl mb-2"></i>
                    <p>동기화 로그가 없습니다.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 자동 동기화 설정 패널 -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="bg-gradient-to-r from-green-600 to-teal-600 px-6 py-4">
            <h2 class="text-xl font-bold text-white flex items-center">
                <i class="fas fa-clock mr-3"></i>
                자동 동기화 설정
            </h2>
        </div>
        
        <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        동기화 간격 (분)
                    </label>
                    <select x-model="autoSyncInterval" 
                            @change="updateAutoSyncSettings()"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-gray-100">
                        <option value="5">5분</option>
                        <option value="10">10분</option>
                        <option value="15">15분</option>
                        <option value="30">30분</option>
                        <option value="60">1시간</option>
                        <option value="0">비활성화</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        다음 자동 동기화
                    </label>
                    <div class="px-3 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300">
                        <span x-text="nextAutoSync || '비활성화'"></span>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <div class="flex items-center">
                    <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 mr-3"></i>
                    <span class="text-sm text-blue-800 dark:text-blue-300">
                        자동 동기화가 활성화되면 설정된 간격으로 모든 활성 플랫폼이 자동으로 동기화됩니다.
                    </span>
                </div>
                <label class="flex items-center">
                    <input type="checkbox" 
                           x-model="autoSyncEnabled" 
                           @change="toggleAutoSync()"
                           class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                    <span class="ml-2 text-sm font-medium text-blue-800 dark:text-blue-300">활성화</span>
                </label>
            </div>
        </div>
    </div>
</div>

<script>
function syncDashboard() {
    return {
        // 상태 데이터
        platforms: [],
        stats: {
            connected_platforms: 0,
            synced_products: 0,
            total_orders: 0,
            sync_errors: 0
        },
        syncLogs: [],
        globalSyncInProgress: false,
        autoSyncEnabled: false,
        autoSyncInterval: 15,
        autoRefreshLogs: true,
        nextAutoSync: null,
        
        // 초기화
        init() {
            this.loadDashboardData();
            this.loadSyncLogs();
            
            // 실시간 업데이트 설정
            setInterval(() => {
                this.loadDashboardData();
                if (this.autoRefreshLogs) {
                    this.loadSyncLogs();
                }
            }, 5000); // 5초마다 업데이트
        },
        
        // 대시보드 데이터 로드
        async loadDashboardData() {
            try {
                const response = await fetch('/api/platforms/sync-status/', {
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrf-token]').content
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    this.platforms = data.platforms;
                    this.stats = data.stats;
                    this.autoSyncEnabled = data.auto_sync_enabled;
                    this.autoSyncInterval = data.auto_sync_interval;
                    this.nextAutoSync = data.next_auto_sync;
                }
            } catch (error) {
                console.error('대시보드 데이터 로드 실패:', error);
                this.showNotification('대시보드 데이터 로드에 실패했습니다.', 'error');
            }
        },
        
        // 동기화 로그 로드
        async loadSyncLogs() {
            try {
                const response = await fetch('/api/platforms/sync-logs/', {
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrf-token]').content
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    this.syncLogs = data.logs;
                }
            } catch (error) {
                console.error('동기화 로그 로드 실패:', error);
            }
        },
        
        // 전체 플랫폼 동기화
        async syncAllPlatforms() {
            if (this.globalSyncInProgress) return;
            
            const result = await Swal.fire({
                title: '전체 동기화 확인',
                text: '모든 활성 플랫폼의 동기화를 시작하시겠습니까?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '동기화 시작',
                cancelButtonText: '취소'
            });
            
            if (result.isConfirmed) {
                this.globalSyncInProgress = true;
                
                try {
                    const response = await fetch('/api/platforms/sync-all/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': document.querySelector('[name=csrf-token]').content
                        }
                    });
                    
                    if (response.ok) {
                        this.showNotification('전체 동기화가 시작되었습니다.', 'success');
                        this.addSyncLog('INFO', '전체 플랫폼 동기화 시작');
                    } else {
                        throw new Error('동기화 시작 실패');
                    }
                } catch (error) {
                    console.error('전체 동기화 실패:', error);
                    this.showNotification('전체 동기화 시작에 실패했습니다.', 'error');
                } finally {
                    this.globalSyncInProgress = false;
                }
            }
        },
        
        // 개별 플랫폼 동기화
        async syncPlatform(platformId) {
            const platform = this.platforms.find(p => p.id === platformId);
            if (!platform || platform.sync_in_progress) return;
            
            platform.sync_in_progress = true;
            platform.sync_progress = 0;
            
            try {
                const response = await fetch(`/api/platforms/${platformId}/sync/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrf-token]').content
                    }
                });
                
                if (response.ok) {
                    this.showNotification(`${platform.name} 동기화가 시작되었습니다.`, 'success');
                    this.addSyncLog('INFO', `${platform.name} 동기화 시작`);
                    
                    // 진행률 시뮬레이션 (실제로는 WebSocket이나 Server-Sent Events 사용 권장)
                    this.simulateProgress(platform);
                } else {
                    throw new Error('동기화 시작 실패');
                }
            } catch (error) {
                console.error('플랫폼 동기화 실패:', error);
                this.showNotification(`${platform.name} 동기화에 실패했습니다.`, 'error');
                platform.sync_in_progress = false;
            }
        },
        
        // 진행률 시뮬레이션 (개발용)
        simulateProgress(platform) {
            const interval = setInterval(() => {
                platform.sync_progress += Math.random() * 20;
                
                if (platform.sync_progress >= 100) {
                    platform.sync_progress = 100;
                    platform.sync_in_progress = false;
                    platform.last_sync_status = 'success';
                    platform.last_sync_at = new Date().toISOString();
                    
                    clearInterval(interval);
                    this.addSyncLog('SUCCESS', `${platform.name} 동기화 완료`);
                    this.showNotification(`${platform.name} 동기화가 완료되었습니다.`, 'success');
                }
            }, 1000);
        },
        
        // 대시보드 새로고침
        refreshDashboard() {
            this.loadDashboardData();
            this.loadSyncLogs();
            this.showNotification('대시보드가 새로고침되었습니다.', 'info');
        },
        
        // 플랫폼 로그 보기
        viewPlatformLogs(platformId) {
            const platform = this.platforms.find(p => p.id === platformId);
            window.open(`/platforms/${platformId}/logs/`, '_blank');
        },
        
        // 플랫폼 설정 편집
        editPlatform(platformId) {
            window.location.href = `/platforms/${platformId}/edit/`;
        },
        
        // 자동 동기화 토글
        async toggleAutoSync() {
            try {
                const response = await fetch('/api/platforms/auto-sync/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrf-token]').content
                    },
                    body: JSON.stringify({
                        enabled: this.autoSyncEnabled,
                        interval: this.autoSyncInterval
                    })
                });
                
                if (response.ok) {
                    const message = this.autoSyncEnabled ? '자동 동기화가 활성화되었습니다.' : '자동 동기화가 비활성화되었습니다.';
                    this.showNotification(message, 'success');
                } else {
                    throw new Error('자동 동기화 설정 실패');
                }
            } catch (error) {
                console.error('자동 동기화 설정 실패:', error);
                this.showNotification('자동 동기화 설정에 실패했습니다.', 'error');
                // 실패 시 이전 상태로 복원
                this.autoSyncEnabled = !this.autoSyncEnabled;
            }
        },
        
        // 자동 동기화 설정 업데이트
        async updateAutoSyncSettings() {
            if (!this.autoSyncEnabled) return;
            
            try {
                const response = await fetch('/api/platforms/auto-sync/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrf-token]').content
                    },
                    body: JSON.stringify({
                        enabled: this.autoSyncEnabled,
                        interval: this.autoSyncInterval
                    })
                });
                
                if (response.ok) {
                    this.showNotification('자동 동기화 설정이 업데이트되었습니다.', 'success');
                    this.loadDashboardData(); // 다음 동기화 시간 업데이트
                } else {
                    throw new Error('설정 업데이트 실패');
                }
            } catch (error) {
                console.error('자동 동기화 설정 업데이트 실패:', error);
                this.showNotification('설정 업데이트에 실패했습니다.', 'error');
            }
        },
        
        // 로그 클리어
        clearLogs() {
            this.syncLogs = [];
            this.showNotification('동기화 로그가 클리어되었습니다.', 'info');
        },
        
        // 동기화 로그 추가
        addSyncLog(level, message) {
            const log = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                level: level,
                message: message
            };
            
            this.syncLogs.unshift(log);
            
            // 최대 100개 로그만 유지
            if (this.syncLogs.length > 100) {
                this.syncLogs = this.syncLogs.slice(0, 100);
            }
        },
        
        // 플랫폼 타입별 배경색
        getPlatformBgColor(platformType) {
            const colors = {
                'SMARTSTORE': 'bg-green-600',
                'COUPANG': 'bg-red-600',
                'GMARKET': 'bg-orange-600',
                'AUCTION': 'bg-blue-600',
                '11ST': 'bg-purple-600',
                'TMON': 'bg-pink-600',
                'WMP': 'bg-yellow-600',
                'LOTTE': 'bg-indigo-600'
            };
            return colors[platformType] || 'bg-gray-600';
        },
        
        // 플랫폼 타입별 아이콘
        getPlatformIcon(platformType) {
            const icons = {
                'SMARTSTORE': 'fas fa-shopping-cart',
                'COUPANG': 'fas fa-box',
                'GMARKET': 'fas fa-store',
                'AUCTION': 'fas fa-gavel',
                '11ST': 'fas fa-shopping-bag',
                'TMON': 'fas fa-ticket-alt',
                'WMP': 'fas fa-warehouse',
                'LOTTE': 'fas fa-building'
            };
            return icons[platformType] || 'fas fa-plug';
        },
        
        // 동기화 상태별 클래스
        getStatusClass(status) {
            const classes = {
                'success': 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300',
                'error': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300',
                'warning': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300',
                'syncing': 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300',
                'pending': 'bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300'
            };
            return classes[status] || classes['pending'];
        },
        
        // 동기화 상태별 아이콘
        getStatusIcon(status) {
            const icons = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'syncing': 'fas fa-sync-alt status-syncing',
                'pending': 'fas fa-clock'
            };
            return icons[status] || icons['pending'];
        },
        
        // 동기화 상태별 텍스트
        getStatusText(status) {
            const texts = {
                'success': '완료',
                'error': '오류',
                'warning': '경고',
                'syncing': '동기화 중',
                'pending': '대기 중'
            };
            return texts[status] || texts['pending'];
        },
        
        // 로그 레벨별 클래스
        getLogLevelClass(level) {
            const classes = {
                'ERROR': 'text-red-400',
                'WARNING': 'text-yellow-400',
                'INFO': 'text-blue-400',
                'SUCCESS': 'text-green-400',
                'DEBUG': 'text-gray-400'
            };
            return classes[level] || classes['INFO'];
        },
        
        // 로그 레벨별 텍스트 클래스
        getLogLevelTextClass(level) {
            const classes = {
                'ERROR': 'text-red-300',
                'WARNING': 'text-yellow-300',
                'INFO': 'text-blue-300',
                'SUCCESS': 'text-green-300',
                'DEBUG': 'text-gray-300'
            };
            return classes[level] || classes['INFO'];
        },
        
        // 숫자 포맷팅
        formatNumber(number) {
            return new Intl.NumberFormat('ko-KR').format(number || 0);
        },
        
        // 날짜/시간 포맷팅
        formatDateTime(datetime) {
            if (!datetime) return '-';
            
            const date = new Date(datetime);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return '방금 전';
            if (diffMins < 60) return `${diffMins}분 전`;
            if (diffHours < 24) return `${diffHours}시간 전`;
            if (diffDays < 7) return `${diffDays}일 전`;
            
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        },
        
        // 시간 포맷팅 (로그용)
        formatTime(datetime) {
            if (!datetime) return '';
            
            const date = new Date(datetime);
            return date.toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        },
        
        // 알림 표시
        showNotification(message, type = 'info') {
            const icons = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle'
            };
            
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            };
            
            // 알림 엘리먼트 생성
            const notification = document.createElement('div');
            notification.className = `${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 transform transition-all duration-300 translate-x-full`;
            notification.innerHTML = `
                <i class="${icons[type]}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-auto">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // 알림 컨테이너에 추가
            const container = document.getElementById('global-notifications');
            container.appendChild(notification);
            
            // 애니메이션 효과
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // 5초 후 자동 제거
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }
    }
}

// 페이지 로드 시 CSRF 토큰 설정
document.addEventListener('DOMContentLoaded', function() {
    const csrfToken = document.querySelector('[name=csrf-token]').content;
    
    // Fetch 요청을 위한 기본 헤더 설정
    window.fetch = new Proxy(window.fetch, {
        apply(fetch, that, args) {
            const [input, init = {}] = args;
            
            if (init.method && init.method !== 'GET') {
                init.headers = {
                    'X-CSRFToken': csrfToken,
                    ...init.headers
                };
            }
            
            return fetch.apply(that, args);
        }
    });
});
</script>
{% endblock %}